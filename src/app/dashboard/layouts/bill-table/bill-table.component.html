<div class="table-responsive">
  <table class="table table-striped table-active">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">
          اسم
        </th>
        <th scope="col">
          مشروع
        </th>
        <th scope="col">
          تاريخ
        </th>
        <th scope="col">
          كمية
        </th>
        <th scope="col">
          السعر
        </th>
        <th scope="col">
          الحالة
        </th>
        <th scope="col">
          المهام
        </th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="
          let bill of bills | paginate: { itemsPerPage: 7, currentPage: p }
        "
      >
        <th scope="row">{{ bill._id }}</th>
        <td>{{ bill.userID?.name }}</td>
        <td>{{ bill.projectID?.name }}</td>
        <td>{{ bill.createdAt | date: "dd/MM/yyyy" }}</td>
        <td>{{ bill.quantity + " " + bill.projectID?.unit }}</td>
        <td>
          {{
            bill.paymentID?.amount || bill.quantity * bill.projectID?.fees
              | currency: "DH"
          }}
        </td>
        <td
          [ngStyle]="{
            color: bill.paymentID ? 'green' : 'red',
            fontWeight: 'bold'
          }"
        >
          {{ bill.paymentID ? "تم دفعها" : "ليس بعد" }}
        </td>
        <td class="functions">
          <i
            class="fa fa-print mr-3"
            (click)="downloadBill(bill)"
            data-toggle="modal"
            data-target="#bill-pdf"
            aria-label="print"
            role="button"
          ></i>
          <i
            *ngIf="from != 'profile' && !bill.paymentID"
            class="fa fa-money"
            (click)="saveBill(bill)"
            data-toggle="modal"
            data-target="#payment-form"
          ></i>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<div class="pagination-div">
  <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>

<!-- Modal -->
<div
  class="modal fade bd-example-modal-lg"
  id="bill-pdf"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          تحميل PDF
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
          (click)="modalClosed()"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <iframe
          *ngIf="url"
          style="width: 100%;"
          [src]="url"
          frameborder="0"
        ></iframe>
      </div>
      <div class="modal-footer">
        <div *ngIf="loading" class="spinner-border text-primary" role="status">
          <span class="sr-only">
            جار التحميل...
          </span>
        </div>
        <a [href]="url" download="facture.pdf"
          ><button [disabled]="loading" type="button" class="btn btn-success">
            تحميل
          </button></a
        >
        <button
          id="close-modal"
          type="button"
          class="btn btn-secondary"
          data-dismiss="modal"
          (click)="modalClosed()"
        >
          إلغاء
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="payment-form"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          تأكيد الدفعة
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div>
          <p>
            أنت تؤكد حقًا الدفع لا يمكنك التراجع عن هذا ؟؟؟
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <div *ngIf="loading" class="spinner-border text-primary" role="status">
          <span class="sr-only">
            جار التحميل...
          </span>
        </div>
        <button
          [disabled]="loading"
          type="button"
          class="btn btn-primary"
          (click)="paymentConfirmation()"
          data-dismiss="modal"
        >
          تأكيد الدفع
        </button>
        <button
          id="close-modal1"
          type="button"
          class="btn btn-secondary"
          data-dismiss="modal"
        >
          إلغاء
        </button>
      </div>
    </div>
  </div>
</div>
