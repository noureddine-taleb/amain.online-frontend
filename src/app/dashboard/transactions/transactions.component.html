<div class="container">
  <div class="row">
    <div class="col-lg-6">
      <form [formGroup]="treasuryForm" (ngSubmit)="submit(treasuryForm.value)" autocomplete="on">
        <div class="form-group">
          <label for="name">
            اسم
          </label>
          <select 
            formControlName="name" 
            name="name" 
            id="name" 
            class="form-control"
            (change)="treasuryForm.patchValue({projectID: $event?.target?.options[$event?.target?.selectedIndex]?.id })"
          >
            <option id="" value="<other>">
              &lt;آخر&gt;
            </option>
            <option
              *ngFor="let p of projects"
              [value]="p.name"
              [id]="p._id"
              >{{ p.name }}
            </option
            >
          </select>
          <!-- <input type="text" class="form-control" formControlName="name" placeholder="water project"> -->
          <div
            *ngIf="treasuryForm.get('name')?.hasError('required')"
            class="invalid-feedback"
          >
            مطلوب اسم
          </div>
          <div
            *ngIf="treasuryForm.get('name').hasError('minlength')"
            class="invalid-feedback"
          >
            يجب أن يكون الاسم بطول 5 أحرف
          </div>
        </div>
        <input 
          type="hidden" 
          name="projectID"
          id="projectID"
          formControlName="projectID" 
        >
        <div class="form-group">
          <label for="desc">
            وصف

          </label>
          <textarea
            type="text"
            id="desc"
            name="desc"
            class="form-control"
            formControlName="desc"
            rows="3"
          >
          </textarea>
          <div
            *ngIf="treasuryForm.get('desc')?.hasError('required')"
            class="invalid-feedback"
          >
            الوصف مطلوب
          </div>
          <div
            *ngIf="treasuryForm.get('desc')?.hasError('minlength')"
            class="invalid-feedback"
          >
            يجب أن يكون الوصف بطول 20 حرفًا
          </div>
        </div>
        <div class="form-group">
          <label class="sr-only" for="amount">الرسوم</label>
          <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text" [ngStyle]="{ 'backgroundColor': (fee.value ? fee.value < 0 ? '#dc3545' : '#28a745' : '#fff') }" ></div>
            </div>
            <input 
            #fee
            autocomplete="off"
            type="number"
            class="form-control"
            formControlName="amount"
            name="amount"
            id="amount"
            placeholder="500"
            >
          </div>
        <!-- </div> -->
        </div>

        <button
          [disabled]="loading"
          type="submit"
          class="btn"
          [ngClass]="{
            'btn-danger': treasuryForm.invalid,
            'btn-success': treasuryForm.valid
          }"
          [ngStyle]="{ marginRight: '15px' }"
        >
        حفظ الصفقة
        </button>
        <div *ngIf="loading" class="spinner-border text-primary" role="status">
          <span class="sr-only">
            جار التحميل...
          </span>
        </div>
      </form>
      <div
        class="alert alert-danger alert-dismissible fade show"
        [ngStyle]="{ marginTop: '20px' }"
        role="alert"
        *ngIf="errors.length"
      >
        <ul>
          <li *ngFor="let error of errors">{{ error }}</li>
        </ul>
        <button
          type="button"
          class="close"
          data-dismiss="alert"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div class="col-lg-6 container">
      <img
        src="/assets/images/treasury.svg"
        alt="404"
        class="img-fluid"
        [ngStyle]="{ maxWidth: '100%' }"
      />
    </div>
  </div>
</div>
