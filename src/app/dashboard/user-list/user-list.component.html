<ng-container *ngIf="users.length; else elseTemplate">
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr class="table-success">
          <th scope="col">
            صورة
          </th>
          <th scope="col">
            اسم
          </th>
          <th scope="col">
            هاتف
          </th>
          <th scope="col">
            تاريخ الولادة
          </th>
          <th scope="col">
            المهام
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let user of users | paginate: { itemsPerPage: 3, currentPage: p }
          "
        >
          <td (click)="billsList(user)" [ngStyle]="{ cursor: 'pointer' }">
            <img
              [ngStyle]="{ width: '80%' }"
              class="img-responsive"
              [src]="getSafeUrl(user)"
              loading="lazy"
            />
          </td>
          <th
            (click)="billsList(user)"
            [ngStyle]="{ cursor: 'pointer' }"
            class="align-middle"
            scope="row"
          >
            {{ user.name }}
          </th>
          <td
            (click)="billsList(user)"
            [ngStyle]="{ cursor: 'pointer' }"
            class="align-middle"
          >
            {{ user.phone }}
          </td>
          <td
            (click)="billsList(user)"
            [ngStyle]="{ cursor: 'pointer' }"
            class="align-middle"
          >
            {{ user.dob | date: "dd/MM/yyy" }}
          </td>
          <td class="functions">
            <i
              class="fa fa-plus-circle mr-3"
              [ngStyle]="{ cursor: 'pointer' }"
              (click)="addBill(user)"
              data-toggle="modal"
              data-target="#bill-form"
            ></i>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pagination-div">
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
  </div>
</ng-container>
<ng-template #elseTemplate>
  <div class="alert alert-info alert-dismissible fade show" role="alert">
    <strong>
      فارغة!
    </strong>
     لا يوجد مستخدمين.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
</ng-template>

<!-- Modal -->
<div
  *ngIf="user"
  class="modal fade bd-example-modal-lg"
  id="bill-form"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          نموذج الفاتورة

        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="row">
        <div class="col-lg-6">
          <form [formGroup]="billForm" (ngSubmit)="submit(billForm.value)">
            <div class="modal-body">
              <div class="form-group">
                <label for="user">
                  اختر المستخدم
                </label>
                <input
                  class="form-control"
                  disabled
                  id="user"
                  name="user"
                  [value]="user.name"
                />
              </div>
              <div class="form-group">
                <label for="projectID">
                  حدد المشروع
                </label>
                <select
                  class="form-control"
                  id="projectID"
                  name="projectID"
                  formControlName="projectID"
                >
                  <option
                    *ngFor="let project of projects"
                    [value]="project._id"
                    >{{ project.name }}</option
                  >
                </select>
                <div
                  *ngIf="billForm.controls.projectID.errors?.required"
                  class="invalid-feedback"
                >
                  المشروع مطلوب
                </div>
              </div>
              <div class="form-group">
                <label for="quantity">
                  كمية

                </label>
                <input
                  type="number"
                  class="form-control"
                  id="quantity"
                  name="quantity"
                  formControlName="quantity"
                  placeholder="2.5"
                />
                <div
                  *ngIf="billForm.controls.quantity.errors?.required"
                  class="invalid-feedback"
                >
                  الكمية مطلوبة
                </div>
                <div
                  *ngIf="billForm.controls.quantity.errors?.min"
                  class="invalid-feedback"
                >
                  يجب أن تكون الكمية أكبر من 0
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <div
                *ngIf="loading"
                class="spinner-border text-primary"
                role="status"
              >
                <span class="sr-only">
                  جار التحميل...

                </span>
              </div>
              <button
                [disabled]="loading"
                type="submit"
                class="btn"
                [ngClass]="{
                  'btn-danger': billForm.invalid,
                  'btn-success': billForm.valid
                }"
                [ngStyle]="{ marginRight: '15px' }"
              >
                إرسال
              </button>
              <button
                #closeModal
                id="close-modal"
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                إلغاء
              </button>
            </div>
          </form>
        </div>
        <div class="col-lg-6">
          <img src="/assets/images/bill.svg" alt="404" class="img-fluid mt-5" />
        </div>
      </div>
    </div>
  </div>
</div>
